@using Fluxor;
@using JailTalk.Application.Dto.Prison;
@using JailTalk.Application.Requests.Prison;
@using JailTalk.Shared;
@using JailTalk.Web.Contracts.Events;
@using JailTalk.Web.Extensions;
@using JailTalk.Web.Store.Prisoner;
@using MediatR;
@inject IMediator Mediator;
@inject IAppMediator AppMediator;


<MudDataGrid Items="@Elements" Virtualize="true" Groupable="false" Bordered="true" ShowMenuIcon="false" FixedHeader="true"
             Height="400px">
    <ToolBarContent>
        <MudText Typo="Typo.h6"><b>Call History</b></MudText>
    </ToolBarContent>
    <Columns>
        <PropertyColumn Property="x => x.Callee" Title="Callee" />
        <PropertyColumn Property="x => x.ContactNumber" Title="Contact Number" />
        <PropertyColumn Property="x => x.CallStartedOn" Title="Started On" />
        <PropertyColumn Property="x => x.CallEndedOn" Title="Ended On" />
        <PropertyColumn Property="x=> x.CallDuration" Title="Duration" />
    </Columns>
</MudDataGrid>
@code {

    [EditorRequired]
    [Parameter]
    public string PrisonerId { get; set; }

    public List<CallHistoryListDto> Elements { get; set; }
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender) return;

        Elements = await Mediator.Send(new CallHistoryQuery()
            {
                LastNDays = 5,
                PrisonerId = Guid.Parse(PrisonerId)
            });
        StateHasChanged();
    }

}
